# GitHub Actions Release Workflow

このプロジェクトでは、完全自動化されたリリースワークフローを設定しています。

## ワークフローの概要

### 1. `tag-version.yml` - バージョンタグ作成
- **トリガー**: `release`ブランチへのプッシュ
- **機能**:
  - `src-tauri/Cargo.toml`からバージョンを自動抽出
  - 全ファイル（`Cargo.toml`, `tauri.conf.json`, `package.json`）でバージョンの整合性をチェック
  - `v1.0.5`形式のタグを自動作成・プッシュ
  - 既存タグがある場合はスキップ

### 2. `build.yml` - ビルドとリリース
- **トリガー**: バージョンタグ（`v*.*.*`）のプッシュ
- **機能**:
  - macOS (ARM/Intel), Ubuntu, Windows向けにビルド
  - GitHub Releaseを自動作成
  - アーティファクトのアップロード

## 使用方法（完全自動化）

### 新しいリリースを作成するには
```bash
# 新しいバージョンを指定してスクリプトを実行
./scripts/update-version.sh 1.0.9

# 以降は全て自動で実行されます:
# 1. バージョンファイルの更新
# 2. releaseブランチへの切り替え
# 3. 変更のコミット・プッシュ
# 4. GitHub Actionsによるタグ作成
# 5. ビルドとリリースの自動実行
```

## ワークフローの流れ

1. **開発者**: `./scripts/update-version.sh X.Y.Z` を実行
2. **スクリプト**: 自動でバージョン更新 → `release`ブランチ切り替え → コミット・プッシュ
3. **自動**: `tag-version.yml`がバージョンタグを作成
4. **自動**: `build.yml`がタグに反応してビルド・リリースを実行

## 必要な設定

以下のシークレットが設定されている必要があります：
- `BUILD_SECRET_KEY`: Tauriのプライベートキー
- `BUILD_PASSWORD`: Tauriキーのパスワード

## 注意事項

- 全バージョンファイルで整合性が取れていない場合、ワークフローは失敗します
- 既存のタグと同じバージョンの場合、タグ作成はスキップされます
- `main`ブランチで作業していても、スクリプトが自動で`release`ブランチに切り替えます
